{% assign current_variant = product.selected_or_first_available_variant %}
{% assign featured_image = current_variant.featured_image | default: product.featured_image %}
<div class="product-img-overlay" style="background-position: center center; background-image: url('{{section.settings.main_image | img_url: '1600x'}}');">
  <div class="page-width">
    <div class="container-inner text-left">
      <div class="pro-title">{{product.title}}</div>
      <div class="pro-item__price-wrapper">{% if product.compare_at_price > product.price %}
        <span class="visually-hidden">{{ 'products.general.regular_price' | t }}</span>
        <s class="pro-item__price--reg">{{ product.compare_at_price | money_without_trailing_zeros }}</s>
        <span class="pro-item__price--sale">{{ 'products.general.now_price_html' | t: price: price }}</span>{% else %}{% if product.price_varies %}
        {{ 'products.general.from_text_html' | t: price: price }}{% else %}{% if product.compare_at_price > product.price %}
        <span class="visually-hidden">{{ 'products.general.sale_price' | t }}</span>{% else %}
        <span class="visually-hidden">{{ 'products.general.regular_price' | t }}</span>{% endif %}
        {{ product.price | money_without_trailing_zeros }}{% endif %}{% endif %}
      </div>
      <div class="pro-description">{{product.description}}</div>
    </div>
  </div>
</div>
{% form 'product', product, id:form_id, class: 'page-width mix-me-tea-kit-form' %}
  <div class="grid grid--uniform grid--no-gutters" data-aos="row-of-2">
      <div class="grid__item small--one-whole medium--two-thirds large-up--two-thirds">
	    <div class="choose-drink">
		  <div class="choose-flavor">
            <div class="choose-heading">
              <span class="step-label">Step 1</span> Choose 5 Drinks
            </div>
            <div class="choose-content-inner">
              <div class="flavor-selector-wrapper" style="display:none;">
                <select id="variant-0">
                  {% for variant in product.variants %}
                  <option{% if variant == product.selected_or_first_available_variant %} selected="selected"{% endif %}{% unless variant.available %} disabled="disabled"{% endunless %} value="{{ variant.id }}" data-sku="{{ variant.sku }}">{{ variant.title }} - {% if variant.available %}{{ variant.price | money_with_currency }}{% else %}{{ 'products.product.sold_out' | t }}{% endif %}</option>
                  {% endfor %}
                </select>
                <input type="number" id="quantity-0" tabindex="1" value="1">
              </div>
              <div class="flavor-selector-wrapper">
                <label for="properties-flavors-1">Drink 1</label>
                <select class="option-selector" id="properties-flavors-1" name="properties[Drink 1]" required>
                  <option value="0" disabled selected>Select Option</option>
                  {%- for block in section.blocks -%}{%- if block.type == 'flavor' -%}
                  <optgroup label="{{ block.settings.option_group_title }}">
                    {%- assign optionlist = block.settings.option_list | split: ', ' -%}
                    {%- for option in optionlist -%}
                    <option value="{{ option | escape }}">{{ option }}</option>
                    {%- endfor -%}
                  </optgroup>
                  {%- endif -%}{%- endfor -%}
                </select>
              </div>
              <div class="flavor-selector-wrapper">
                <label for="properties-flavors-2">Drink 2</label>
                <select class="option-selector" id="properties-flavors-2" name="properties[Drink 2]" required>
                  <option value="0" disabled selected>Select Option</option>
                  {%- for block in section.blocks -%}{%- if block.type == 'flavor' -%}
                  <optgroup label="{{ block.settings.option_group_title }}">
                    {%- assign optionlist = block.settings.option_list | split: ', ' -%}
                    {%- for option in optionlist -%}
                    <option value="{{ option | escape }}">{{ option }}</option>
                    {%- endfor -%}
                  </optgroup>
                  {%- endif -%}{%- endfor -%}
                </select>
              </div>
              <div class="flavor-selector-wrapper">
                <label for="properties-flavors-3">Drink 3</label>
                <select class="option-selector" id="properties-flavors-3" name="properties[Drink 3]" required>
                  <option value="0" disabled selected>Select Option</option>
                  {%- for block in section.blocks -%}{%- if block.type == 'flavor' -%}
                  <optgroup label="{{ block.settings.option_group_title }}">
                    {%- assign optionlist = block.settings.option_list | split: ', ' -%}
                    {%- for option in optionlist -%}
                    <option value="{{ option | escape }}">{{ option }}</option>
                    {%- endfor -%}
                  </optgroup>
                  {%- endif -%}{%- endfor -%}
                </select>
              </div>
              <div class="flavor-selector-wrapper">
                <label for="properties-flavors-4">Drink 4</label>
                <select class="option-selector" id="properties-flavors-4" name="properties[Drink 4]" required>
                  <option value="0" disabled selected>Select Option</option>
                  {%- for block in section.blocks -%}{%- if block.type == 'flavor' -%}
                  <optgroup label="{{ block.settings.option_group_title }}">
                    {%- assign optionlist = block.settings.option_list | split: ', ' -%}
                    {%- for option in optionlist -%}
                    <option value="{{ option | escape }}">{{ option }}</option>
                    {%- endfor -%}
                  </optgroup>
                  {%- endif -%}{%- endfor -%}
                </select>
              </div>
              <div class="flavor-selector-wrapper">
                <label for="properties-flavors-5">Drink 5</label>
                <select class="option-selector" id="properties-flavors-5" name="properties[Drink 5]" required>
                  <option value="0" disabled selected>Select Option</option>
                  {%- for block in section.blocks -%}{%- if block.type == 'flavor' -%}
                  <optgroup label="{{ block.settings.option_group_title }}">
                    {%- assign optionlist = block.settings.option_list | split: ', ' -%}
                    {%- for option in optionlist -%}
                    <option value="{{ option | escape }}">{{ option }}</option>
                    {%- endfor -%}
                  </optgroup>
                  {%- endif -%}{%- endfor -%}
                </select>
              </div>
            </div>
		  </div>

          
		  <div class="choose-content">
            <div class="choose-heading">
              <span class="step-label">Step 2</span> Toppings
            </div>
           {%- for block in section.blocks -%}{%- if block.type == 'topping' -%}
		   <div class="topping-selector-wrapper">
             <div class="grid__item small--one-half medium--one-half large-up--one-half">
               <div class="overlay_unchecked" id="properties-toppings-{{block.settings.topping_name | handle}}-check">
                 <span class="overlay_background_c"><i class="fa fa-check-circle" aria-hidden="true"></i></span>
                 <img src="{{block.settings.topping_image | img_url: 'large'}}" alt="{{ block.settings.topping_image.alt | escape }}" class="summary-img">
               </div>
             </div>
             <div class="grid__item small--one-half medium--one-half large-up--one-half" style="padding-right: 30px;">
               <label for="properties-toppings-{{block.settings.topping_name | handle}}">{{block.settings.topping_name}}</label>
               <select class="option-quantity" id="properties-toppings-{{block.settings.topping_name | handle}}" name="properties[Topping: {{block.settings.topping_name}}]">
                 <option value="0">Quantity</option>
                 <option value="1">1</option>
                 <option value="2">2</option>
                 <option value="3">3</option>
                 <option value="4">4</option>
                 <option value="5">5</option>
               </select>
             </div>
		   </div>
           {%- endif -%}{%- endfor -%}
		  </div>{%- comment -%}{%- endcomment -%}
          <div class="choose-heading" style="display:none;">
	        <span class="step-label">Step 3</span> Accessories
		  </div>
		  <div class="choose-content" style="display:none;">
           {%- for block in section.blocks -%}{%- if block.type == 'accessories' -%}
		   <div class="topping-selector-wrapper">
             <div class="grid__item small--one-half medium--one-half large-up--one-half">
               <div class="overlay_unchecked" id="properties-accessoriess-{{block.settings.accessories_name | handle}}-check">
                 <span class="overlay_background_c"><i class="fa fa-check-circle" aria-hidden="true"></i></span>
                 <img src="{{block.settings.accessories_image | img_url: 'large'}}" alt="{{ block.settings.accessories_image.alt | escape }}" class="summary-img">
               </div>
             </div>
             <div class="grid__item small--one-half medium--one-half large-up--one-half" style="padding-right: 30px;">
               <label for="properties-accessoriess-{{block.settings.accessories_name | handle}}">{{block.settings.accessories_name}}</label>
               <select class="option-quantity" id="properties-accessoriess-{{block.settings.accessories_name | handle}}" name="properties[Accessories: {{block.settings.accessories_name}}]">
                 <option value="0">Quantity</option>
                 <option value="1" selected>1</option>
                 <option value="2">2</option>
                 <option value="3">3</option>
                 <option value="4">4</option>
                 <option value="5">5</option>
               </select>
             </div>
		   </div>
           {%- endif -%}{%- endfor -%}
		  </div>
		</div>
        
      </div>
      <div class="grid__item small--one-whole medium--one-third large-up--one-third">
        <img src="{{ featured_image | img_url: 'grande' }}" class="summary-img">
        <div class="order-summary">
		  <div class="summary-heading">
            Order Summary
		  </div>
          <span class="product-label">{{ product.title }}</span>
		  <div class="summary-content">
            <div class="item-heading">Drinks <span class="included">(Included)</span></div>
            <ul class="all-items">
              {%- for i in (1..5) -%}
              <li id="properties-flavor-{{i}}" data-connect="properties-flavors-{{i}}" style="display: none;"><span></span><i class="fa fa-minus-circle" aria-hidden="true"></i></li>
              {%- endfor -%}
            </ul>
            
            <div class="item-heading">Toppings <span class="included">(Included)</span></div>
            <ul class="all-items">
              {%- for block in section.blocks -%}{%- if block.type == 'topping' -%}
              <li id="properties-topping-{{block.settings.topping_name | handle}}" data-connect="properties-toppings-{{block.settings.topping_name | handle}}" style="display: none;"><span></span><i class="fa fa-minus-circle" aria-hidden="true"></i></li>
              {%- endif -%}{%- endfor -%}
            </ul>
            
            <div class="item-heading">Accessories <span class="included">(Included)</span></div>
            <ul class="all-items">
              {%- for block in section.blocks -%}{%- if block.type == 'accessories' -%}
              <li id="properties-accessories-{{block.settings.accessories_name | handle}}" data-connect="properties-accessories-{{block.settings.accessories_name | handle}}"><span>{{block.settings.accessories_name}}</span><i class="fa fa-check-circle" aria-hidden="true"></i></li>
              {%- endif -%}{%- endfor -%}
            </ul>
            
            <div class="cart-button">
              {% if product.available %}
              <button id="submit-table" type="submit" name="add" class="btn btn--add-to-cart{% if section.settings.enable_payment_button %} btn--secondary-accent{% endif %}" disabled="disabled">
                <span class="btn__text">Add to Bag</span>
              </button>
              {% else %}
              <button type="button" class="btn btn--add-to-cart btn--disabled{% if section.settings.enable_payment_button %} btn--secondary-accent{% endif %}" disabled="disabled">
                {{ 'products.product.sold_out' | t }}
              </button>
              {% endif %}
              <a href="/" class="returntocollection">Cancel</a>
            </div>
		  </div>
          
		</div>
      </div>
  </div>
{% endform %}

{% schema %}
{
  "name": "Product Customizer 1",
  "max_blocks": 20,
  "settings": [
    {
      "type": "image_picker",
      "id": "main_image",
      "label": "Main Image"
    }
  ],
  "blocks": [
    {
      "type": "flavor",
      "name": "Flavor",
      "settings": [
        {
          "type": "text",
          "id": "option_group_title",
          "label": "Option Group Title"
        },
        {
          "type": "textarea",
          "id": "option_list",
          "label": "Options List"
        }
      ]
    },
    {
      "type": "accessories",
      "name": "Accessories",
      "settings": [
        {
          "type": "image_picker",
          "id": "accessories_image",
          "label": "Accessories Image"
        },
        {
          "type": "text",
          "id": "accessories_name",
          "label": "Accessories Name"
        }
      ]
    },
    {
      "type": "topping",
      "name": "Topping",
      "settings": [
        {
          "type": "image_picker",
          "id": "topping_image",
          "label": "Topping Image"
        },
        {
          "type": "text",
          "id": "topping_name",
          "label": "Topping Name"
        }
      ]
    }
  ]
}
{% endschema %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/additional-methods.min.js"></script>
<script>
var length = {{ section.blocks.size }};

$(document).ready(function () {
    {%- for i in (1..5) -%}
    $("#properties-flavor-{{i}} span").text(''); $("#properties-flavor-{{i}}").slideUp(); $("#properties-flavors-{{i}}").change(function() { $("#properties-flavor-{{i}} span").text($(this).val()); $("#properties-flavor-{{i}}").slideDown(); if($('#properties-flavors-1 :selected').val() != 0 && $('#properties-flavors-2 :selected').val() != 0 && $('#properties-flavors-3 :selected').val() != 0 && $('#properties-flavors-4 :selected').val() != 0 && $('#properties-flavors-5 :selected').val() != 0) { $('#submit-table').attr('disabled', false); } });
    {%- endfor -%}
    {%- for block in section.blocks -%}{%- if block.type == 'topping' -%}
    $("#properties-topping-{{block.settings.topping_name | handle}} span").text('');
    $("#properties-topping-{{block.settings.topping_name | handle}}").slideUp();
    $("#properties-toppings-{{block.settings.topping_name | handle}}").change(function() { if ( $(this).val() < 1) { $("#properties-topping-{{block.settings.topping_name | handle}} span").text(''); $("#properties-topping-{{block.settings.topping_name | handle}}").slideUp(); $("#properties-toppings-{{block.settings.topping_name | handle}}-check").removeClass('overlay_checked').addClass('overlay_unchecked'); } else { $("#properties-topping-{{block.settings.topping_name | handle}} span").text($(this).val()+ ' x {{block.settings.topping_name}}'); $("#properties-topping-{{block.settings.topping_name | handle}}").slideDown(); $("#properties-toppings-{{block.settings.topping_name | handle}}-check").removeClass('overlay_unchecked').addClass('overlay_checked'); } });
    {%- endif -%}{%- endfor -%}
    {%- for block in section.blocks -%}{%- if block.type == 'accessories' -%}
    $("#properties-accessoriess-{{block.settings.accessories_name | handle}}").change(function() { if ( $(this).val() < 1) { $("#properties-accessories-{{block.settings.accessories_name | handle}} span").text(''); $("#properties-accessories-{{block.settings.accessories_name | handle}}").slideUp(); $("#properties-accessoriess-{{block.settings.accessories_name | handle}}-check").removeClass('overlay_checked').addClass('overlay_unchecked'); } else { $("#properties-accessories-{{block.settings.accessories_name | handle}} span").text('{{block.settings.accessories_name}}'); $("#properties-accessories-{{block.settings.accessories_name | handle}}").slideDown(); $("#properties-accessoriess-{{block.settings.accessories_name | handle}}-check").removeClass('overlay_unchecked').addClass('overlay_checked'); } });
    {%- endif -%}{%- endfor -%}
    $("ul.all-items li i.fa.fa-minus-circle").click(function() { var idi = $(this).parents("li").data('connect'); $(this).parents("li").slideUp(); $('#'+idi).val('0').trigger("change"); if($('#properties-flavors-1 :selected').val() != 0 && $('#properties-flavors-2 :selected').val() != 0 && $('#properties-flavors-3 :selected').val() != 0 && $('#properties-flavors-4 :selected').val() != 0 && $('#properties-flavors-5 :selected').val() != 0) { $('#submit-table').attr('disabled', false); } });
	$("#submit-table").click(function(e) {     
		e.preventDefault();
		//array for Variant Titles
		var toAdd1 = new Array(); var toAdd2 = new Array(); var qty ;
		for(i=0; i < length; i++){ if ( i === 0) { toAdd1.push({ variant_id: $("#variant-"+i).val(), quantity_id: $("#quantity-"+i).val() || 0 }); } else { toAdd2.push({ variant_id: $("#variant-"+i).val(), quantity_id: $("#quantity-"+i).val() || 0 }); } }
		function moveAlong(){
			if (toAdd1.length) { var request = toAdd1.shift(); var tempId= request.variant_id; var tempQty = request.quantity_id; var params = {
					type: 'POST',
					url: '/cart/add.js', data: 'quantity='+tempQty+'&id='+tempId {%- for i in (1..5) -%}+'&properties[Drink {{i}}]='+$("#properties-flavors-"+{{i}}).val(){%- endfor -%}{%- for block in section.blocks -%}{%- if block.type == 'topping' -%}+'&properties[Topping: {{block.settings.topping_name}}]='+$("#properties-toppings-{{block.settings.topping_name | handle}}").val(){%- endif -%}{%- if block.type == 'accessories' -%}+'&properties[Accessories {{forloop.index | minus: 5 }}]={{block.settings.accessories_name}}'{%- endif -%}{%- endfor -%},
					dataType: 'json',
					success: function(line_item) {
						moveAlong();
					},
					error: function() {
						moveAlong();
					} }; $.ajax(params); } else if (toAdd2.length) { var request = toAdd2.shift(); var tempId= request.variant_id; var tempQty = request.quantity_id; var params = {
					type: 'POST',
					url: '/cart/add.js',
					data: 'quantity='+tempQty+'&id='+tempId,
					dataType: 'json',
					success: function(line_item) {
						moveAlong();
					},
					error: function() {
						moveAlong();
					} }; $.ajax(params); } else { document.location.href = '/cart'; } }; moveAlong();
	});
});

</script>
